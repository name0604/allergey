// 알림 권한 요청
Notification.requestPermission().then(permission => {
    if (permission === 'granted') {
        // 사용자가 알림을 허용한 경우
        document.getElementById("submitMeals").onclick = function() {
            const allergiesInput = document.getElementById('allergies').value;
            setCookie('allergies', allergiesInput, 7); // 7일 동안 쿠키에 저장

            const allergies = allergiesInput.split(',').map(num => num.trim());
            const buttons = document.querySelectorAll('button[data-allergy]');
            
            // 모든 버튼 색상 초기화
            buttons.forEach(button => {
                button.classList.remove('black');
            });
            
            // 입력된 알레르지에 해당하는 버튼 색상 변경
            buttons.forEach(button => {
                const buttonAllergies = button.dataset.allergy.split(',').map(num => num.trim());
                if (buttonAllergies.some(allergy => allergies.includes(allergy))) {
                    button.classList.add('black');
                }
            });

            // 식사 정보 처리
            const meals = allergiesInput.split(',').map(meal => meal.trim());
            buttons.forEach(button => {
                button.style.display = meals.includes(button.dataset.meal) ? "inline-block" : "none"; // 보여주거나 숨기기
            });

            // 알림 설정
            const today = new Date();
            const notificationTime = new Date(today.getFullYear(), 7, 1, 0, 0); // 예: 8월 1일 자정
            
            if (notificationTime > today) {
                const timeToNotification = notificationTime - today; // 밀리초 단위
                setTimeout(() => {
                    new Notification('식사 알림', {
                        body: '오늘의 식사 정보를 확인하세요!',
                    });
                }, timeToNotification);
            }
        }
    }
});
